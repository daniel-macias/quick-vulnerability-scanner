// pages/api/scanFile.ts
import type { NextApiRequest, NextApiResponse } from 'next';
import axios from 'axios';

export const config = {
  api: {
    bodyParser: false,
  },
};

export default async (req: NextApiRequest, res: NextApiResponse) => {
  if (req.method === 'POST') {
    try {
      // Forward the request to VirusTotal API
      const result = await axios({
        method: 'post',
        url: 'https://www.virustotal.com/api/v3/files',
        headers: {
          'x-apikey': process.env.NEXT_PUBLIC_VT_API_KEY, // Secure API key usage
          'Content-Type': 'multipart/form-data',
        },
        data: req.body, // Stream the request body directly to VirusTotal
      });

      

      res.status(200).json(result.data);
    } catch (error) {
      console.error('Error scanning file:', error);
      res.status(500).json({ message: 'Error scanning file' });
    }
  } else {
    res.setHeader('Allow', ['POST']);
    res.status(405).end(`Method ${req.method} Not Allowed`);
  }
};